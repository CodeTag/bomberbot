<!DOCTYPE html>

<html>
<head>
	<title>Bomberbot challenge </title>
	<style>
		body{
			background-color:#000;
		}
	</style>
	<script>
		var tipos= ['c','d','r','t'];
		var colores= ['a','b','f','m','n','r','v'];
		
		var crearRandomRobot = function(){
			var tipoSel = Math.round(Math.random()*(tipos.length-1));
			var colorSel = Math.round(Math.random()*(colores.length-1));
			return tipos[tipoSel]+""+colores[colorSel];
		}
		window.onload= function(){
			var tablero = document.getElementById("tablero");
			var mapa = 	"XXXXXXXXXXXXX\n"+
						"X__LL_L_LL__X\n"+
						"X_XLX_X_XLX_X\n"+
						"XLL_______LLX\n"+
						"XLX_XLXLX_XLX\n"+
						"X___LLLLL___X\n"+
						"XLX_XLXLX_XLX\n"+
						"X___LLLLL___X\n"+
						"XLX_XLXLX_XLX\n"+
						"XLL_______LLX\n"+
						"X_XLX_X_XLX_X\n"+
						"X__LL_L_LL__X\n"+
						"XXXXXXXXXXXXX\n";
			if(tablero.getContext) {
				var ctx = tablero.getContext('2d');
				var bloque = new Image();
				bloque.src = "img/SolidoBloque50.png";
				var ladrillo = new Image();
				ladrillo.src = "img/LadrilloBloque50.png";
				
				var bot1 = new Image();
				bot1.onload = function(){ctx.drawImage(bot1,0,0,size, size);};
				bot1.src = "img/bots/r"+crearRandomRobot()+".png";
				
				var bot2 = new Image();
				bot2.onload = function(){ctx.drawImage(bot2,0,0,size, size);};
				bot2.src = "img/bots/r"+crearRandomRobot()+".png";
				
				var bot3 = new Image();
				bot3.onload = function(){ctx.drawImage(bot3,0,0,size, size);};
				bot3.src = "img/bots/r"+crearRandomRobot()+".png";
				
				var bot4 = new Image();
				bot4.onload = function(){ctx.drawImage(bot4,0,0,size, size);};
				bot4.src = "img/bots/r"+crearRandomRobot()+".png";
			}
			var size=50;
			var fondo = function(){
				var i=0;
				var j=0;
				var cont=0;
				ctx.beginPath();
				ctx.rect(0, 0, size*14, size*14);
				ctx.fill();
				while(cont<mapa.length){
					switch(mapa[cont]){
						case 'X':
							ctx.drawImage(bloque, 10+i*size,10+j*size,size,size);
							i++;
						break;
						case 'L':
							ctx.drawImage(ladrillo, 10+i*size,10+j*size,size,size);
							i++;
						break;
						case '_':
							i++;
						break;
						case '\n':
							j++;
							i=0;
						break;
					}
					cont++;
				}
				ctx.stroke();
			};
			var xYellow=3;
			var yYellow=3;
			var pintar = function(){
				ctx.beginPath();				
				ctx.drawImage(bot1, 10+size*xYellow,10-size*0.65+size*yYellow,size,size*1.5);
				ctx.drawImage(bot4, 10+size*(12-yYellow),10-size*0.65+size*xYellow,size,size*1.5);
				ctx.drawImage(bot3, 10+size*yYellow,10-size*0.65+size*(12-xYellow),size,size*1.5);
				ctx.drawImage(bot2, 10+size*(12-xYellow),10-size*0.65+size*(12-yYellow),size,size*1.5);
				ctx.stroke();
				
			};
			
			var factorMovbots=1/30;
			var direccion="o";
			var moverBots= function(){
				if(direccion=="o"){
					xYellow+=factorMovbots;
					if(xYellow>=9){
						direccion="s";	
					}
				}else if(direccion=="s"){
					yYellow+=factorMovbots;
					if(yYellow>=9){
						direccion="e";	
					}
				}else if(direccion=="e"){
					xYellow-=factorMovbots;
					if(xYellow<=3){
						direccion="n";	
					}
				}else if(direccion=="n"){
					yYellow-=factorMovbots;
					if(yYellow<=3){
						direccion="o";	
					}
				}
				
				fondo();
				pintar();
			};
			
		    window.requestAnimFrame = (function(){
    			return  window.requestAnimationFrame || 
            	window.webkitRequestAnimationFrame || 
              	window.mozRequestAnimationFrame    || 
              	window.oRequestAnimationFrame      || 
              	window.msRequestAnimationFrame     || 
              	function( callback ){
                	window.setTimeout(callback, 1000 / 60);
              	};
    		})();
    		
    		(function animloop(){
				requestAnimFrame(animloop);
				moverBots();
			})();
			
		}
	</script>

</head>

<body>

	<canvas id="tablero" width="700px" height="700px" style="background-color:#000;">
		<p>what the fuck browser are you using??</p>
	</canvas>

</body>



</html>
